"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[886,495],{5495:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Y});var o=a(6598),r={key:0,class:"transition-opacity top-0 left-0 min-h-full min-w-full z-auto bg-black bg-opacity-40 absolute overflow-y-scroll"},n={class:"flex items-center justify-center min-h-screen"},s={class:"relative px-4 w-full max-w-2xl h-full md:h-auto"},i={class:"relative bg-gray-800 rounded-lg shadow"},d={class:"flex justify-between items-start p-3 rounded-t border-b border-gray-500"},l={class:"text-xl font-semibold text-gray-300 lg:text-2xl"},c={class:"p-4 space-y-6"},m={class:"relative z-0 mb-5 w-full group"},u=(0,o.createElementVNode)("label",{for:"name",class:"absolute text-base text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:left-0 peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-100 peer-focus:-translate-y-6"},"Nombre Periodo *",-1),p={class:"relative mb-5 z-0 w-full group"},h=(0,o.createElementVNode)("label",{for:"address",class:"block mb-2 text-gray-400"},"Seleccione el rango de fechas:",-1),g={class:"flex items-center"},f=(0,o.createElementVNode)("span",{class:"mx-2 text-gray-400"},"Desde",-1),w=(0,o.createElementVNode)("span",{class:"mr-2 ml-8 text-gray-400"},"Hasta",-1),v={class:"flex items-center p-3 space-x-2 rounded-b border-t border-gray-500"};var b=a(9669),y=a.n(b),D=a(8223),_=a(5090),E=a(7484),x=a.n(E),N=a(6607),k=a.n(N),V=a(285),M=a.n(V);x().extend(k()),x().extend(M());const C={directives:{focus:{mounted:function(e){return e.focus()}}},components:{Calendar:D.Z},props:{managementData:{type:Object,default:{}},periodDates:Array,id_management:Number,id_company:Number,id_user:Number,realstartdate:String,realenddate:String,showModal:{type:Boolean,default:!1},modalTitle:String,modalButtons:String,periodData:{type:Object,default:{id_period:"",id_user:"",id_management:"",status:"",start_date:"",end_date:"",name:""}}},watch:{periodData:{handler:function(){this.newData=Object.assign({},this.periodData)}}},data:function(){return{newData:Object.assign({},this.periodData),dates:this.periodDates,errorName:!1,messageErrorName:"",errorStart_date:!1,messageErrorStart_date:"",errorEnd_date:!1,messageErrorEnd_date:"",errorGeneric:!1,messageErrorGeneric:""}},methods:{flushErrors:function(){this.errorName=!1,this.messageErrorName="",this.errorStart_date=!1,this.messageErrorStart_date="",this.errorEnd_date=!1,this.messageErrorEnd_date="",this.errorGeneric=!1,this.messageErrorGeneric=""},cancel:function(){this.$emit("close"),this.newData=Object.assign({},this.periodData),this.flushErrors()},setColorForDate:function(e){for(var t=parseFloat(e.month)+parseFloat(1),a=x()(e.day+"/"+t+"/"+e.year,"D/M/YYYY",!0),o="white",r=0;r<this.periodDates.length;r++){var n=x()(this.periodDates[r].start_date,"DD/MM/YYYY",!0),s=x()(this.periodDates[r].end_date,"DD/MM/YYYY",!0);x()(a).isBetween(n,s,null,"[]")&&(o="red",this.periodDates[r].id_period==this.periodData.id_period&&(o="green"))}return x()(a).isBetween(x()(this.managementData.start_date,"DD/MM/YYYY"),x()(this.managementData.end_date,"DD/MM/YYYY"),null,"[]")||(o="LightCoral"),o},removeEmptyValues:function(e){var t=e;for(var a in t)""!=t[a]&&null!=t[a]||delete t[a];return t},setErrors:function(e,t){for(var a in e)"name"==a&&e[a][0]&&(this.errorName=!0,_.Notify.failure(e[a][0])),"start_date"==a&&e[a][0]&&(this.errorStart_date=!0,_.Notify.failure(e[a][0])),"end_date"==a&&e[a][0]&&(console.log(e[a][0]),this.errorEnd_date=!0,_.Notify.failure(e[a][0]))},create:function(){var e=this;console.log(this.newData);var t={name:this.newData.name,start_date:x()(this.newData.start_date).format("YYYY-MM-DD"),end_date:x()(this.newData.end_date).format("YYYY-MM-DD"),id_management:this.id_management.toString()};_.Notify.init({clickToClose:!0}),y().post(route("period.api.create"),t).catch((function(t){e.flushErrors(),t.response.data.message?1==t.response.data.type?_.Notify.failure(t.response.data.message):e.setErrors(t.response.data.errors,t.response.data.message):1==t.response.data.type?_.Notify.failure("Error al crear"):(e.errorGeneric=!0,e.messageErrorGeneric=t.response.data.message)})).then((function(t){try{var a;null!==(a=t.data)&&void 0!==a&&a.success&&(_.Notify.success("Periodo creado con éxito"),e.$emit("updatePeriods"),e.cancel())}catch(e){console.log("No se pudo completar la peticion")}}))},update:function(){var e=this;console.log(this.newData);var t={id_period:this.newData.id_period,name:this.newData.name,start_date:x()(this.newData.start_date instanceof Date?this.newData.start_date.getTime():x()(this.newData.start_date,"DD/MM/YYYY")).format("YYYY-MM-DD"),end_date:x()(this.newData.end_date instanceof Date?this.newData.end_date.getTime():x()(this.newData.end_date,"DD/MM/YYYY")).format("YYYY-MM-DD"),id_company:this.id_company,realstartdate:this.realstartdate,realenddate:this.realenddate};t=this.removeEmptyValues(t),_.Notify.init({clickToClose:!0}),y().post(route("period.api.update"),t).catch((function(t){e.flushErrors(),t.response.data.message?1==t.response.data.type?_.Notify.failure(t.response.data.message):e.setErrors(t.response.data.errors,t.response.data.message):1==t.response.data.type?_.Notify.failure("Error al actualizar"):(e.errorGeneric=!0,e.messageErrorGeneric=t.response.data.message)})).then((function(t){var a;null!=t&&null!==(a=t.data)&&void 0!==a&&a.success&&(_.Notify.success("Se ha actualizado el periodo"),e.$emit("updatePeriods"),e.$emit("cleanSelectedPeriod"),e.cancel())}))}}};const Y=(0,a(3744).Z)(C,[["render",function(e,t,a,b,y,D){var _=(0,o.resolveComponent)("Calendar"),E=(0,o.resolveDirective)("focus");return a.showModal?((0,o.openBlock)(),(0,o.createElementBlock)("div",r,[(0,o.createElementVNode)("div",n,[(0,o.createElementVNode)("div",s,[(0,o.createElementVNode)("div",i,[(0,o.createElementVNode)("div",d,[(0,o.createElementVNode)("h3",l,(0,o.toDisplayString)(a.modalTitle),1)]),(0,o.createElementVNode)("div",c,[(0,o.createElementVNode)("form",null,[(0,o.createElementVNode)("div",m,[(0,o.withDirectives)((0,o.createElementVNode)("input",{autocomplete:"off",type:"text",class:"block py-2.5 px-0 w-full text-xl text-gray-300 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-600 peer",oninput:"javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);",onkeypress:"return /[A-Z 0-9]/i.test(event.key)",maxlength:"15","onUpdate:modelValue":t[0]||(t[0]=function(e){return y.newData.name=e}),placeholder:" ",required:""},null,512),[[E],[o.vModelText,y.newData.name]]),u]),(0,o.createElementVNode)("div",p,[h,(0,o.createElementVNode)("div",g,[f,(0,o.createVNode)(_,{modelValue:y.newData.start_date,"onUpdate:modelValue":t[1]||(t[1]=function(e){return y.newData.start_date=e}),dateFormat:"dd/mm/yy",baseZIndex:100},{date:(0,o.withCtx)((function(e){return[(0,o.createElementVNode)("p",{style:(0,o.normalizeStyle)("color: "+D.setColorForDate(e.date)+";")},(0,o.toDisplayString)(e.date.day),5)]})),_:1},8,["modelValue"]),w,(0,o.createVNode)(_,{baseZIndex:100,modelValue:y.newData.end_date,"onUpdate:modelValue":t[2]||(t[2]=function(e){return y.newData.end_date=e}),dateFormat:"dd/mm/yy"},{date:(0,o.withCtx)((function(e){return[(0,o.createElementVNode)("p",{style:(0,o.normalizeStyle)("color: "+D.setColorForDate(e.date)+";")},(0,o.toDisplayString)(e.date.day),5)]})),_:1},8,["modelValue"])])])])]),(0,o.createElementVNode)("div",v,[(0,o.createElementVNode)("button",{onClick:t[3]||(t[3]=function(e){return D.cancel()}),type:"button",class:"text-white bg-rose-600 hover:bg-rose-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center"}," Cancelar "),"register"==a.modalButtons?((0,o.openBlock)(),(0,o.createElementBlock)("button",{key:0,onClick:t[4]||(t[4]=function(){return D.create&&D.create.apply(D,arguments)}),type:"button",id:"register",class:"text-white bg-green-600 hover:bg-green-700 font-medium rounded-lg text-sm px-5 py-2.5 text-center"}," Registrar ")):(0,o.createCommentVNode)("",!0),"edit"==a.modalButtons?((0,o.openBlock)(),(0,o.createElementBlock)("button",{key:1,onClick:t[5]||(t[5]=function(){return D.update&&D.update.apply(D,arguments)}),type:"button",id:"edit",class:"text-white bg-yellow-400 hover:bg-yellow-500 font-medium rounded-lg text-sm px-5 py-2.5 text-center"}," Editar ")):(0,o.createCommentVNode)("",!0)])])])])])):(0,o.createCommentVNode)("",!0)}]])},6886:(e,t,a)=>{a.r(t),a.d(t,{default:()=>B});var o=a(6598),r={class:"mt-5"},n={class:"grid grid-cols-1 sm:grid-cols-2 mb-2"},s={class:"col-span-1 self-end justify-center order-last sm:order-first"},i=[(0,o.createElementVNode)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"white",viewBox:"0 0 16 16"},[(0,o.createElementVNode)("path",{d:"M15.683 3a2 2 0 0 0-2-2h-7.08a2 2 0 0 0-1.519.698L.241 7.35a1 1 0 0 0 0 1.302l4.843 5.65A2 2 0 0 0 6.603 15h7.08a2 2 0 0 0 2-2V3zM5.829 5.854a.5.5 0 1 1 .707-.708l2.147 2.147 2.146-2.147a.5.5 0 1 1 .707.708L9.39 8l2.146 2.146a.5.5 0 0 1-.707.708L8.683 8.707l-2.147 2.147a.5.5 0 0 1-.707-.708L7.976 8 5.829 5.854z"})],-1)],d={class:"col-span-1 self-end mb-2 sm:mb-0"},l={class:"flex justify-center sm:justify-end space-x-2"},c=["disabled"],m=[(0,o.createElementVNode)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[(0,o.createElementVNode)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)],u=[(0,o.createElementVNode)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[(0,o.createElementVNode)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})],-1)],p=["disabled"],h=[(0,o.createElementVNode)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[(0,o.createElementVNode)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)],g=["disabled"],f=[(0,o.createElementVNode)("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},[(0,o.createElementVNode)("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)],w=(0,o.createTextVNode)(" No hay periodos, ¡añade uno! ");var v=a(922),b=a(5247),y=a(5495),D=a(6358),_=a(9669),E=a.n(_),x=a(7915),N=a(7484),k=a.n(N),V=a(8642),M=a(4443),C=a(1678);const Y={directives:{tooltip:x.Z},emits:["updateData","goBack","setTitleUp"],components:{DataTable:v.Z,Column:b.Z,ModalPeriod:y.default},props:{management:{type:Object,required:!0}},data:function(){return{filters:{global:{value:null,matchMode:D.a6.CONTAINS}},periodsData:[],selectedPeriod:{},showModalCreate:!1,showModalEdit:!1}},watch:{management:{handler:function(){this.setDataTable()}}},mounted:function(){this.setDataTable(),this.$emit("setTitleUp","Administración de gestión -> ".concat(this.management.name," [ ").concat(this.management.start_date," - ").concat(this.management.end_date," ]"))},methods:{goReport:function(){window.open("\n                http://reportes.queeserp.tk/flow.html?_flowId=viewReportFlow&_flowId=viewReportFlow&ParentFolderUri=%2Fthemes%2FReportes&reportUnit=%2Fthemes%2FReportes%2FReportePeriodo&standAlone=true&id_user=".concat(this.management.id_user,"&id_company=").concat(this.management.id_company,"&id_management=").concat(this.management.id_management,"&j_username=jasperadmin&j_password=bitnami&sessionDecorator=no\n                "))},deletePeriod:function(){var e=this;V.Confirm.init({titleColor:"#FF0000",messageColor:"#FF0000",okButtonBackground:"#FF0000"}),V.Confirm.show("¿Deseas eliminar el periodo?","Estás a punto de eliminar el periodo "+this.selectedPeriod.name,"Eliminar","Cancelar",(function(){M.Loading.standard({clickToClose:!1,svgSize:"200"});var t={id_period:e.selectedPeriod.id_period,id_user:e.management.id_user,id_company:e.management.id_company,start_date:e.selectedPeriod.start_date,end_date:e.selectedPeriod.end_date};C.Notify.init({clickToClose:!0}),console.log("pasando trash",t),E().post(route("period.api.delete"),t).then((function(t){var a;null!==(a=t.data)&&void 0!==a&&a.success?(e.setDataTable(),C.Notify.success("Periodo eliminado"),e.selectedPeriod={}):(C.Notify.failure(t.data.message),e.selectedPeriod={}),M.Loading.remove(250)})).catch((function(e){C.Notify.failure(e),M.Loading.remove(250)}))}))},formatDate:function(e){e.forEach((function(e){e.start_date=k()(e.start_date).format("DD/MM/YYYY"),e.end_date=k()(e.end_date).format("DD/MM/YYYY")}))},setDataTable:function(){var e=this;E().get(route("period.api.read",this.management.id_management)).then((function(t){e.periodsData=t.data,e.formatDate(e.periodsData)}))}}};const B=(0,a(3744).Z)(Y,[["render",function(e,t,a,v,b,y){var D=(0,o.resolveComponent)("Column"),_=(0,o.resolveComponent)("DataTable"),E=(0,o.resolveComponent)("ModalPeriod"),x=(0,o.resolveDirective)("tooltip");return(0,o.openBlock)(),(0,o.createElementBlock)(o.Fragment,null,[(0,o.createElementVNode)("div",r,[(0,o.createElementVNode)("div",n,[(0,o.createElementVNode)("div",s,[(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("button",{onClick:t[0]||(t[0]=function(t){e.$emit("goBack"),e.$emit("setTitleUp","Administración de gestión")}),class:"bg-sky-600 hover:bg-sky-700 text-white rounded-lg px-4 py-2.5"},i)),[[x,{value:"Volver a gestiones",class:"text-center"},void 0,{right:!0}]])]),(0,o.createElementVNode)("div",d,[(0,o.createElementVNode)("div",l,[(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("button",{disabled:0==a.management.status,onClick:t[1]||(t[1]=function(e){return b.showModalCreate=!0}),class:"disabled:bg-green-800 bg-green-500 hover:bg-green-600 text-white rounded-lg px-4 py-2.5"},m,8,c)),[[x,{value:"Añadir un periodo",class:"text-center"},void 0,{bottom:!0}]]),(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("button",{onClick:t[2]||(t[2]=function(){return y.goReport&&y.goReport.apply(y,arguments)}),class:"disabled:bg-indigo-800 bg-indigo-700 hover:bg-indigo-600 text-white rounded-lg px-4 py-2.5"},u)),[[x,{value:"Generar reportes",class:"text-center"},void 0,{bottom:!0}]]),(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("button",{disabled:0==Object.keys(b.selectedPeriod).length||0==a.management.status,onClick:t[3]||(t[3]=function(e){return b.showModalEdit=!0}),class:"disabled:bg-yellow-600 bg-yellow-400 hover:bg-yellow-500 text-white rounded-lg px-4 py-2.5"},h,8,p)),[[x,{value:"Edita periodo",class:"text-center"},void 0,{bottom:!0}]]),(0,o.withDirectives)(((0,o.openBlock)(),(0,o.createElementBlock)("button",{onClick:t[4]||(t[4]=function(e){return y.deletePeriod()}),disabled:0==Object.keys(b.selectedPeriod).length,class:"disabled:bg-rose-800 bg-rose-500 hover:bg-rose-600 text-white rounded-lg px-4 py-2.5"},f,8,g)),[[x,{value:"Eliminar esta periodo",class:"text-center"},void 0,{left:!0}]])])])])]),(0,o.createVNode)(_,{class:"p-datatable-lg",value:b.periodsData,dataKey:"id_period",paginator:!0,rows:10,responsiveLayout:"scroll",selection:b.selectedPeriod,"onUpdate:selection":t[5]||(t[5]=function(e){return b.selectedPeriod=e}),selectionMode:"single",filters:b.filters,"onUpdate:filters":t[6]||(t[6]=function(e){return b.filters=e}),style:{}},{empty:(0,o.withCtx)((function(){return[w]})),default:(0,o.withCtx)((function(){return[(0,o.createVNode)(D,{field:"name",header:"Nombre",sortable:!0,filterMatchMode:"contains"}),(0,o.createVNode)(D,{field:"start_date",header:"Fecha inicio",sortable:!1,filterMatchMode:"contains"}),(0,o.createVNode)(D,{field:"end_date",header:"Fecha fin",sortable:!1,filterMatchMode:"contains"}),(0,o.createVNode)(D,{field:"status",header:"Estado",sortable:!0,filterMatchMode:"contains"},{body:(0,o.withCtx)((function(e){return[(0,o.createElementVNode)("span",{class:(0,o.normalizeClass)("bg-"+(1==e.data.status?"green":"red")+"-600 text-white p-1.5 rounded-lg")},(0,o.toDisplayString)(1==e.data.status?"ABIERTO":"CERRADO"),3)]})),_:1})]})),_:1},8,["value","selection","filters"]),(0,o.createVNode)(E,{managementData:a.management,periodDates:b.periodsData,id_management:a.management.id_management,showModal:b.showModalCreate,modalTitle:"Crear periodo",modalButtons:"register",onClose:t[7]||(t[7]=function(e){return b.showModalCreate=!1}),onUpdatePeriods:y.setDataTable},null,8,["managementData","periodDates","id_management","showModal","onUpdatePeriods"]),(0,o.createVNode)(E,{managementData:a.management,periodData:b.selectedPeriod,periodDates:b.periodsData,id_management:a.management.id_management,id_company:a.management.id_company,id_user:a.management.id_user,showModal:b.showModalEdit,modalTitle:"Editar Periodo",modalButtons:"edit",onClose:t[8]||(t[8]=function(e){return b.showModalEdit=!1}),onUpdatePeriods:y.setDataTable,onCleanSelectedPeriod:t[9]||(t[9]=function(e){return b.selectedPeriod={}}),realstartdate:b.selectedPeriod.start_date,realenddate:b.selectedPeriod.end_date},null,8,["managementData","periodData","periodDates","id_management","id_company","id_user","showModal","onUpdatePeriods","realstartdate","realenddate"])],64)}]])}}]);